JWT 및 Casbin을 사용한 Gin 어플리케이션 인증 및 권한부여
===

## JWT

JWT(JSON Web Token)란 `JSON 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token입니다.` 
>클레임(Claim)이란 사용자 정보나 데이터 속성 등을 의미한다.

JWT는 `토큰 자체를 정보로 사용하는 Self-Contained 방식으로` 정보를 안전하게 전달합니다.

<br>

## JWT 구조

JWT는 `Header, Payload, Signature`의 3부분으로 이루어져 있으며, JSON형태인 `각 부분은 Base64로 인코딩 되어` 표횐됩니다. 

또한 `각각의 부분을 이어 주기 위해 "." 구분자를 사용하여 구분합니다.`

추가로 Base64는 암호화된 문자열이 아니고 같은 문자열에 대해 항상 같은 인코딩 문자열을 반환합니다.

### Header

토큰의 Header는 typ와 alg 두가지 정보로 구성됩니다. alg는 Header를 암호화 하는 것이 아니고 `Signature를 해싱하기 위한 알고리즘을 지정하는 것입니다.`

- typ : 토큰의 타입을 지정합니다 ex) JWT
- alg : 알고리즘 방식을 지정하며 서명(Signature) 및 토큰 검증에 사용합니다. ex) SHA256(HS256), RSA, ...

```
{
  "alg": "HS256",
  "typ": JWT 
}
```


### Payload

토큰의 Payload에는 `토큰에서 사용할 정보의 조각들인 클레임(Claim)`이 담겨있습니다.

클레임은 총 3가지로 나누어지며 JSON(key/Value) 형태로 다수의 정보를 넣을 수 있습니다.

1. 등록된 클레임 (토큰 정보를 표현하기 위해 이미 정해진 종류의 데이터)

2. 공개 클레임 (사용자 정의 클레임으로, 공개용 정보를 위해 사용, 충돌 방지를 위해 URI포맷을 이용 -> 주로 sub(토큰 제목),exp(토큰 만료시간),iss(토큰 발급자)를 많이 사용한다.)

3. 비공개 클레임 (사용자 정의 클레임으로, 서버와 클라이언트 사이에 임의로 지정한 정보를 저장)

### Signature(서명)

서명은 토큰을 인코딩하거나 유효성을 검증할 때 사용하는 고유한 암호화 코드입니다.

서명은 헤더와 페이로드의 값을 각각 Base64로 인코딩하고 인코딩한 값을 비밀키를 이용해 헤더에서 정의한 알고리즘으로 해싱을 하고 이 값을 다시 Base64로 인코딩하여 생성합니다.

<Br>

## JWT 단점

1. JWT는 만료 시간이 지나야지 JWT가 무효화가 가능하다. 사용자가 로그인한 후 로그아웃을 하더라도 만료시간이 지나지 않는다면 토큰은 유효합니다.

2. JWT는 토큰이 만료될 때까지 해커에 의해 탈취되어 사용될 가능성이 있습니다.

3. 토큰이 만료되면 다시 로그인을 해야합니다.

### JWT 단점 보완

1. DB에 JWT 메타데이터를 저장합니다. 사용자가 로그아웃을 요청한다면 이를 기록해서 JWT를 무효화 시킬 수 있습니다.

2. Access Token이 만료된 경우 Refresh 토큰을 사용하여 새 Access Token을 생성하여 Access Token이 만료가 되더라도 사용자가 다시 로그인을 하지 않게 만들 수 있습니다.

<br>

---

JWT 참고 [https://mangkyu.tistory.com/56]

